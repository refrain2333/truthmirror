# 真相之镜 (Truth Mirror) - 完整项目介绍

## 🎯 项目概述

"真相之镜"是一个基于AI分析和众包验证的事件真相验证平台。通过整合智能搜索、AI内容分析和用户投票机制，为网络事件提供客观、透明的真相验证服务，帮助用户在信息爆炸的时代找到真相。

### 核心理念
- **AI + 人工智能**：结合AI技术的高效分析和人类智慧的判断力
- **透明化流程**：完整展示验证过程，确保结果可信
- **众包验证**：通过社区协作提高验证结果的准确性和公正性
- **客观中立**：基于事实和证据，避免主观偏见

## 🚀 核心功能

### 1. 事件生命周期管理
完整的事件状态流转机制：
- **PENDING** (待审核) → **NOMINATED** (已提名) → **PROCESSING** (AI分析中) → **VOTING** (投票中) → **CONFIRMED** (已确认)

### 2. 智能触发机制
- **10人关注自动触发**：当事件获得10人关注时，自动启动AI分析
- **20票自动确认**：投票总数达到20票时，自动转为确认状态
- **实时状态监控**：系统自动监控并更新事件状态

### 3. AI分析系统
- **多维度分析**：从信息源可靠性、内容逻辑性、事实一致性等角度分析
- **智能评级**：提供可靠(reliable)、存疑(questionable)、不可靠(unreliable)、信息不足(insufficient)四级评估
- **自动摘要生成**：基于AI分析生成客观的事件摘要

### 4. 众包投票系统
- **二元投票**：支持(support) / 反对(oppose) 简洁投票机制
- **实时统计**：动态显示投票进度和结果分布
- **投票详情**：展示投票用户和评论，增加透明度

### 5. 用户管理系统
- **角色权限**：普通用户、管理员分级权限管理
- **个人中心**：用户信息管理、活动记录、设置功能
- **统计追踪**：用户活跃度、投票参与度等数据统计

## 🏗️ 技术架构

### 后端技术栈
- **框架**：FastAPI + Python 3.8+
- **数据库**：MySQL + PyMySQL (无ORM，直接SQL操作)
- **API设计**：RESTful API，支持CORS跨域
- **异步处理**：多线程模拟AI分析过程
- **数据验证**：Pydantic模型验证

### 前端技术栈
- **核心技术**：纯HTML + CSS + JavaScript (无框架依赖)
- **设计风格**：现代化卡片布局，响应式设计
- **状态管理**：localStorage + 动态DOM操作
- **交互体验**：实时数据更新，流畅的用户体验

### 数据库设计
核心表结构：
- **users**：用户信息、权限、统计数据
- **events**：事件主表，包含状态、AI分析结果、投票统计
- **votes**：投票记录，支持用户评论
- **information_sources**：事件信息源，支持AI分析结果存储
- **event_interests**：用户兴趣表，追踪关注度

## 📱 功能模块详解

### 事件管理模块
- **事件提交**：用户提交待验证事件（标题、描述、关键词）
- **状态流转**：自动化的事件生命周期管理
- **兴趣统计**：实时追踪用户关注度
- **搜索筛选**：支持状态筛选、关键词搜索、分页浏览

### AI分析模块 (当前为模拟实现)
- **自动触发**：达到10人关注时自动启动
- **模拟分析**：10秒模拟AI分析过程
- **结果生成**：随机生成AI摘要和评级
- **数据填充**：自动填充模拟的兴趣数据和信息源

### 投票系统模块
- **投票管理**：防重复投票，支持投票撤销
- **统计分析**：实时计算支持率、反对率
- **结果判定**：基于投票数量自动确认结果
- **投票详情**：展示投票历史和用户评论

### 用户界面模块
- **首页**：事件列表、统计信息、搜索筛选
- **事件详情页**：完整事件信息、AI分析结果、投票界面
- **个人中心**：用户信息编辑、活动统计
- **关于页面**：平台介绍、使用说明、联系方式

## 🔄 业务流程

### 完整验证流程
1. **事件提交**：用户提交待验证事件
2. **社区关注**：其他用户表示兴趣，累积关注度
3. **自动触发**：达到10人关注时，系统自动启动AI分析
4. **AI处理**：模拟AI分析过程，生成分析报告和评级
5. **投票阶段**：用户基于AI分析结果进行投票
6. **结果确认**：达到20票时自动确认，形成最终结论

### 关键业务规则
- **兴趣阈值**：10人关注触发AI分析
- **投票阈值**：20票总数触发自动确认
- **状态自动化**：系统自动管理状态转换，无需人工干预
- **防重复机制**：用户对同一事件只能投票一次、表示兴趣一次

## 🎨 用户体验设计

### 设计原则
- **简洁直观**：清晰的信息层次，易于理解的操作流程
- **实时反馈**：操作结果即时显示，状态变化实时更新
- **响应式设计**：适配各种设备屏幕尺寸
- **一致性**：统一的视觉风格和交互模式

### 视觉设计
- **主色调**：#2c5aa0 (专业蓝色)
- **卡片布局**：现代化的卡片式信息展示
- **渐变效果**：精美的渐变背景和按钮设计
- **图标系统**：文字图标替代emoji，保持专业感

## 📊 项目特色

### 技术特色
- **无框架依赖**：前端纯原生实现，轻量高效
- **直接SQL操作**：后端无ORM，性能优化
- **模拟AI系统**：完整的AI分析流程模拟
- **自动化流程**：智能的状态管理和触发机制

### 业务特色
- **双重验证**：AI分析 + 人工投票的双重保障
- **透明流程**：完整展示验证过程和数据
- **社区驱动**：基于用户参与的众包验证模式
- **实时响应**：即时的状态更新和结果反馈

## 🚧 当前实现状态

### 已完成功能 ✅
- ✅ 完整的事件生命周期管理
- ✅ 用户管理和权限系统
- ✅ 投票系统和统计分析
- ✅ AI分析模拟和自动触发
- ✅ 前端界面和用户体验
- ✅ 数据库设计和API接口
- ✅ 搜索筛选和分页功能

### 待扩展功能 🔄
- 🔄 真实AI集成 (OpenAI/Claude API)
- 🔄 SearXNG搜索引擎集成
- 🔄 用户认证和JWT系统
- 🔄 实时通知系统
- 🔄 管理员推翻功能
- 🔄 数据分析和报表系统

## 🎯 项目价值

### 社会价值
- **信息净化**：帮助用户识别虚假信息，净化网络环境
- **真相还原**：通过科学方法还原事件真相
- **公众教育**：提高公众的信息辨别能力
- **社会和谐**：减少因虚假信息导致的社会矛盾

### 技术价值
- **AI应用实践**：AI技术在信息验证领域的创新应用
- **众包模式探索**：人机结合的协作验证模式
- **系统架构示范**：现代Web应用的完整技术实现
- **开源贡献**：为开源社区提供完整的项目参考

## 📈 发展规划

### 短期目标 (1-3个月)
- 集成真实AI分析能力
- 完善用户认证系统
- 优化性能和用户体验
- 增加更多事件类型支持

### 中期目标 (3-6个月)
- 集成多个搜索引擎
- 实现实时通知系统
- 开发移动端应用
- 建立用户社区

### 长期目标 (6-12个月)
- 构建AI训练数据集
- 开发专业版功能
- 建立合作伙伴网络
- 推广到更多应用场景

## 🔧 技术实现细节

### API接口设计

#### 事件管理 API
```http
POST   /api/v1/events/                    # 创建事件
GET    /api/v1/events/                    # 获取事件列表 (支持分页、状态筛选)
GET    /api/v1/events/{id}                # 获取事件详情
POST   /api/v1/events/{id}/interest       # 表示兴趣 (自动触发AI分析)
POST   /api/v1/events/{id}/approve        # 审核通过 (管理员)
POST   /api/v1/events/{id}/reset-status   # 重置状态 (管理员)
```

#### 投票系统 API
```http
POST   /api/v1/votes/                     # 创建投票
GET    /api/v1/votes/event/{id}           # 获取事件投票列表
GET    /api/v1/events/{id}/votes/stats    # 获取投票统计
DELETE /api/v1/votes/{id}                 # 删除投票
```

#### 用户管理 API
```http
GET    /api/v1/users/{id}                 # 获取用户信息
PUT    /api/v1/users/{id}                 # 更新用户信息
POST   /api/v1/users/                     # 创建用户
```

### 数据库表结构详解

#### events 表 (事件主表)
```sql
CREATE TABLE `events` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `title` VARCHAR(200) NOT NULL COMMENT '事件标题',
    `description` TEXT NOT NULL COMMENT '事件描述',
    `keywords` VARCHAR(500) NOT NULL COMMENT '关键词',
    `status` ENUM('pending', 'nominated', 'processing', 'voting', 'confirmed') DEFAULT 'pending',
    `interest_count` INT DEFAULT 0 COMMENT '感兴趣用户数',
    `vote_count` INT DEFAULT 0 COMMENT '总投票数',
    `support_votes` INT DEFAULT 0 COMMENT '支持票数',
    `oppose_votes` INT DEFAULT 0 COMMENT '反对票数',
    `ai_summary` TEXT DEFAULT NULL COMMENT 'AI分析总结',
    `ai_rating` ENUM('reliable', 'questionable', 'unreliable', 'insufficient') DEFAULT NULL,
    `creator_id` INT NOT NULL,
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (`creator_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
);
```

#### votes 表 (投票记录)
```sql
CREATE TABLE `votes` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `event_id` INT NOT NULL,
    `user_id` INT NOT NULL,
    `stance` ENUM('support', 'oppose') NOT NULL COMMENT '投票立场',
    `user_comment` TEXT DEFAULT NULL COMMENT '用户投票理由',
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (`event_id`) REFERENCES `events`(`id`) ON DELETE CASCADE,
    FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
    UNIQUE KEY `unique_user_event_vote` (`event_id`, `user_id`)
);
```

### 核心业务逻辑

#### 自动触发机制
```python
def check_and_update_event_status(self, event_id: int, interest_threshold: int = 10) -> bool:
    """检查并自动更新事件状态"""
    # 获取当前状态和统计数据
    event_info = self.get_event_info(event_id)

    # 10人关注触发AI分析
    if event_info['status'] == 'nominated' and event_info['interest_count'] >= 10:
        self.update_event_status(event_id, 'processing')
        self.start_ai_analysis_simulation(event_id)  # 异步AI分析

    # 20票触发自动确认
    elif event_info['status'] == 'voting' and event_info['vote_count'] >= 20:
        self.update_event_status(event_id, 'confirmed')
```

#### AI分析模拟
```python
def start_ai_analysis_simulation(self, event_id: int):
    """启动AI分析模拟（异步执行）"""
    def simulate_ai_analysis():
        time.sleep(10)  # 模拟10秒AI分析过程

        # 生成模拟结果
        ai_summary = random.choice(AI_SUMMARY_TEMPLATES)
        ai_rating = random.choice(['reliable', 'questionable', 'unreliable', 'insufficient'])

        # 填充模拟数据
        self.fill_simulation_interests(event_id)  # 10条兴趣数据
        self.fill_simulation_sources(event_id)    # 5条信息源

        # 完成AI处理，转入投票阶段
        self.complete_ai_processing(event_id, ai_summary, ai_rating)

    # 后台线程执行
    threading.Thread(target=simulate_ai_analysis, daemon=True).start()
```

## 📋 部署指南

### 环境要求
- Python 3.8+
- MySQL 5.7+
- 现代浏览器支持

### 快速部署

#### 1. 后端部署
```bash
# 克隆项目
git clone [repository-url]
cd 真相之镜/backend

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 或 venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件，配置数据库连接

# 初始化数据库
mysql -u root -p < init/database_init_notriggers.sql

# 启动服务
python -m uvicorn app.main:app --host 127.0.0.1 --port 8000 --reload
```

#### 2. 前端部署
```bash
# 进入前端目录
cd ../frontend

# 使用Python内置服务器 (开发环境)
python -m http.server 8080

# 或使用Node.js serve (如果已安装)
npx serve -s . -l 8080

# 访问应用
# 前端: http://127.0.0.1:8080
# 后端API: http://127.0.0.1:8000
# API文档: http://127.0.0.1:8000/docs
```

### 生产环境部署
```bash
# 使用Gunicorn部署后端
pip install gunicorn
gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000

# 使用Nginx部署前端
# 配置Nginx反向代理和静态文件服务
```

## 🧪 测试指南

### 功能测试流程

#### 1. 事件生命周期测试
```bash
# 1. 创建事件 (状态: pending)
curl -X POST "http://127.0.0.1:8000/api/v1/events/" \
  -H "Content-Type: application/json" \
  -d '{"title":"测试事件","description":"测试描述","keywords":"测试"}'

# 2. 审核通过 (状态: pending → nominated)
curl -X POST "http://127.0.0.1:8000/api/v1/events/1/approve"

# 3. 表示兴趣 (10次后自动触发AI分析: nominated → processing → voting)
for i in {1..10}; do
  curl -X POST "http://127.0.0.1:8000/api/v1/events/1/interest" \
    -H "x-user-id: $i"
done

# 4. 投票 (20票后自动确认: voting → confirmed)
for i in {1..20}; do
  stance=$( [ $((i % 2)) -eq 0 ] && echo "support" || echo "oppose" )
  curl -X POST "http://127.0.0.1:8000/api/v1/votes/" \
    -H "Content-Type: application/json" \
    -H "x-user-id: $i" \
    -d "{\"event_id\":1,\"stance\":\"$stance\"}"
done
```

#### 2. 前端功能测试
- 访问 http://127.0.0.1:8080
- 测试事件列表、搜索筛选、分页功能
- 测试事件详情页、投票功能
- 测试用户注册、登录、个人中心
- 测试事件提交、状态变化

### 性能测试
```bash
# 使用Apache Bench测试API性能
ab -n 1000 -c 10 http://127.0.0.1:8000/api/v1/events/

# 使用curl测试响应时间
curl -w "@curl-format.txt" -o /dev/null -s "http://127.0.0.1:8000/api/v1/events/"
```

## 🔍 监控和日志

### 日志系统
- **应用日志**：详细的业务操作日志
- **错误日志**：异常和错误信息记录
- **性能日志**：API响应时间和数据库查询性能
- **用户行为日志**：用户操作轨迹分析

### 监控指标
- **系统性能**：CPU、内存、磁盘使用率
- **数据库性能**：连接数、查询时间、慢查询
- **API性能**：响应时间、错误率、并发数
- **业务指标**：事件数量、用户活跃度、投票参与率

---

**真相之镜** - 让真相照亮世界，让智慧指引未来。

*项目开源地址：[GitHub Repository]*
*在线演示：[Demo URL]*
*技术文档：[Documentation URL]*
