# 真相之镜 - 项目完整指导文档

## 项目概述

"真相之镜"是一个基于AI分析和众包验证的事件真相验证平台。通过整合SearXNG元搜索引擎、AI内容分析和用户投票机制，为网络事件提供客观、透明的真相验证服务。

## 核心功能流程

### 1. 事件提交阶段
- 用户提交待验证事件（标题、描述、关键词）
- 系统创建事件条目，状态为"待提名"
- 其他用户可对事件表示兴趣（点赞/关注）
- 当兴趣度达到阈值时，事件状态变更为"进行中"

### 2. 信息收集阶段
- 通过SearXNG API进行多源搜索
- 基于事件关键词搜索相关新闻、文章
- 过滤无关内容，保留强相关信息
- 目标：收集20个高质量信息源

### 3. AI分析阶段
- 对每个信息源进行内容提取和清理
- AI分析每个信息源的核心观点
- 分类为"正方支持"或"反方质疑"观点
- 生成客观的内容摘要和关键论据

### 4. 综合判断阶段
- AI基于所有信息源进行综合分析
- 给出正方和反方的详细论据列举
- AI给出初步判断倾向（支持正方/反方）
- 生成完整的分析报告

### 5. 众包投票阶段
- 用户查看AI分析报告和原始信息源
- 用户进行正方/反方投票
- 实时显示投票统计和趋势
- 当总票数>10000且差距>50%时确定结果

### 6. 真相确认阶段
- 系统自动判定获胜方为"事件真相"
- 生成最终真相报告
- 事件状态变更为"已确认"
- 用于"惊醒世人"的展示

### 7. DLC功能：真相推翻
- 管理员权限的错误真相修正功能
- 提供证据支持的真相推翻机制
- 历史记录和修正日志

## 技术架构设计

### 系统架构
```
前端界面 (React/Vue)
    ↓
API网关 (FastAPI)
    ↓
业务逻辑层 (Python)
    ↓
数据访问层 (SQLAlchemy)
    ↓
数据库 (PostgreSQL)

外部服务:
- SearXNG API (搜索)
- OpenAI/Claude API (AI分析)
- Redis (缓存)
- Celery (异步任务)
```

### 核心模块

#### 1. 事件管理模块 (event_manager)
- 事件CRUD操作
- 状态流转管理
- 兴趣度统计

#### 2. 搜索引擎模块 (search_engine)
- SearXNG API集成
- 搜索结果过滤
- 内容相关性评分

#### 3. 内容分析模块 (content_analyzer)
- 网页内容提取
- AI内容分析
- 观点分类和摘要

#### 4. 投票系统模块 (voting_system)
- 用户投票管理
- 投票统计和分析
- 结果判定逻辑

#### 5. 用户管理模块 (user_manager)
- 用户认证和授权
- 权限管理
- 活跃度统计

#### 6. 通知系统模块 (notification)
- 事件状态变更通知
- 投票结果通知
- 系统消息推送

## 数据库设计

### 核心表结构

#### events (事件表)
```sql
- id: 主键
- title: 事件标题
- description: 事件描述
- keywords: 关键词
- status: 状态 (pending/nominated/processing/voting/confirmed)
- interest_count: 兴趣度计数
- created_at: 创建时间
- updated_at: 更新时间
- creator_id: 创建者ID
```

#### information_sources (信息源表)
```sql
- id: 主键
- event_id: 关联事件ID
- url: 信息源链接
- title: 标题
- content: 提取的内容
- stance: 立场 (support/oppose)
- relevance_score: 相关性评分
- ai_summary: AI摘要
- created_at: 创建时间
```

#### votes (投票表)
```sql
- id: 主键
- event_id: 关联事件ID
- user_id: 用户ID
- stance: 投票立场 (support/oppose)
- created_at: 投票时间
```

#### users (用户表)
```sql
- id: 主键
- username: 用户名
- email: 邮箱
- role: 角色 (user/admin)
- created_at: 注册时间
- is_active: 是否激活
```

#### ai_analyses (AI分析表)
```sql
- id: 主键
- event_id: 关联事件ID
- support_arguments: 正方论据
- oppose_arguments: 反方论据
- ai_judgment: AI判断
- confidence_score: 置信度
- created_at: 分析时间
```

## 开发环境搭建

### 后端环境 (Python)
```bash
# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install fastapi uvicorn sqlalchemy psycopg2-binary
pip install celery redis requests beautifulsoup4
pip install openai anthropic python-multipart
```

### 前端环境 (可选)
```bash
# 使用React
npx create-react-app truth-mirror-frontend
cd truth-mirror-frontend
npm install axios react-router-dom

# 或使用Vue
npm create vue@latest truth-mirror-frontend
cd truth-mirror-frontend
npm install axios vue-router
```

```

## 项目目录结构
```
truth-mirror/
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py              # FastAPI应用入口
│   │   ├── config.py            # 配置文件
│   │   ├── database.py          # 数据库连接
│   │   ├── models/              # 数据模型
│   │   ├── api/                 # API路由
│   │   ├── services/            # 业务逻辑
│   │   ├── tasks/               # Celery任务
│   │   └── utils/               # 工具函数
│   ├── requirements.txt
│   └── alembic/                 # 数据库迁移
├── frontend/                    # 前端代码
├─
├── README.md
└── docs/                        # 文档
```

## 开发计划

### 第一阶段：MVP开发 (2-3周)
1. 基础数据库设计和API框架
2. 事件提交和管理功能
3. 简单的搜索和内容提取
4. 基础的投票功能

### 第二阶段：AI集成 (2-3周)
1. 集成SearXNG搜索API
2. 实现AI内容分析功能
3. 完善投票和统计系统
4. 添加用户管理功能

### 第三阶段：优化完善 (2-3周)
1. 前端界面开发
2. 性能优化和缓存
3. 通知系统实现
4. 测试和部署

### 第四阶段：高级功能 (按需)
1. 管理员推翻功能
2. 高级分析和可视化
3. 移动端适配
4. 扩展功能开发

## 关键技术点

### 1. SearXNG集成
- API调用和结果解析
- 多搜索引擎结果聚合
- 搜索结果去重和排序

### 2. AI内容分析
- 网页内容提取和清理
- 自然语言处理和情感分析
- 观点分类和摘要生成

### 3. 异步任务处理
- Celery任务队列
- 长时间运行任务管理
- 任务状态跟踪

### 4. 实时数据更新
- WebSocket连接
- 投票结果实时推送
- 事件状态变更通知

